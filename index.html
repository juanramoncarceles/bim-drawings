<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>VisualARQ Drawings Viewer</title>
  <!-- To verify I own the github page to Google. May be removed. -->
  <meta name="google-site-verification" content="bzDIZgLIOBkyJkDteOPLxzZlWGRsvQ4a9tPBpeSzFDQ" />
  <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
  <link rel="icon" href="/favicon.ico" type="image/x-icon">
  <meta name="description" content="VisualARQ web app to review project drawings.">
  <link rel="manifest" href="/manifest.json">
  <meta name="theme-color" content="#f6f6f6" />
  <!-- Safari on iOS doesnt support the web app manifest so this is needed -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="apple-mobile-web-app-title" content="VA Viewer">
  <link rel="apple-touch-icon" href="/src/assets/logos/vadv-logo-152.png">
  <link href="https://fonts.googleapis.com/css?family=Oswald:200,400,500&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="src/styles/styles.css">
</head>

<body>
  <header style="display: none;">
    <span>
      <img src="src/assets/vadv-logo.png" alt="VisualARQ Drawings Viewer Logo" title="VisualARQ Drawings Viewer">
    </span>
    <h1>VisualARQ Drawings Viewer</h1>
    <h2 id="projectsListBtn" class="buttonBase light sides" data-open="false" style="display: none;"></h2>
    <div id="drawingsBtns" class="dropdown-container" style="display: none;">
      <button class="buttonBase light sides">Pick a drawing</button>
      <ul class="dropdown-content">
        <!-- Test content -->
        <!-- <li data-id="drawing1">Drawing 1</li>
        <li data-id="drawing2">Drawing 2</li> -->
      </ul>
    </div>
    <div id="toolbarsContainer" style="display: none;">
      <div id="dropdown-container-1" class="dropdown-container responsive">
        <button class="icon-btn" id="tool-1" title="Distance">
          <img src="src/assets/icons/distIcon.svg">
        </button>
        <div class="dropdown-content">
          <button class="icon-btn" id="tool-2" title="Area">
            <img src="src/assets/icons/areaIcon.svg">
          </button>
          <button class="icon-btn" id="tool-3" title="Angle">
            <img src="src/assets/icons/angleIcon.svg">
          </button>
          <button class="icon-btn" id="tool-4" title="Elements Data">
            <img src="src/assets/icons/elementDataIcon.svg">
          </button>
          <button class="icon-btn" id="tool-5" title="Comment Element">
            <img src="src/assets/icons/commentIcon.svg">
          </button>
        </div>
      </div>
    </div>
    <div class="global-nav-btns">
      <button id="notificationBtn" class="icon-btn disabled">
        <svg viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg">
          <path d="M467.812,431.851l-36.629-61.056c-16.917-28.181-25.856-60.459-25.856-93.312V224c0-67.52-45.056-124.629-106.667-143.04	V42.667C298.66,19.136,279.524,0,255.993,0s-42.667,19.136-42.667,42.667V80.96C151.716,99.371,106.66,156.48,106.66,224v53.483	c0,32.853-8.939,65.109-25.835,93.291l-36.629,61.056c-1.984,3.307-2.027,7.403-0.128,10.752c1.899,3.349,5.419,5.419,9.259,5.419	H458.66c3.84,0,7.381-2.069,9.28-5.397C469.839,439.275,469.775,435.136,467.812,431.851z" />
          <path d="M188.815,469.333C200.847,494.464,226.319,512,255.993,512s55.147-17.536,67.179-42.667H188.815z" />
        </svg>
      </button>
      <button id="saveBtn" class="icon-btn disabled">
        <svg viewBox="0 0 462 462" xmlns="http://www.w3.org/2000/svg">
          <path d="m457.166 103.834-99-99c-3.094-3.094-7.283-4.834-11.666-4.834h-330c-9.12 0-16.5 7.38-16.5 16.5v429c0 9.12 7.38 16.5 16.5 16.5h429c9.12 0 16.5-7.38 16.5-16.5v-330c0-4.383-1.741-8.572-4.834-11.666zm-325.166-70.834h198v165h-198zm297 396h-396v-396h66v181.5c0 9.12 7.38 16.5 16.5 16.5h231c9.12 0 16.5-7.38 16.5-16.5v-158.168l66 66z" />
        </svg>
      </button>
      <button id="sideNavToggle"></button>
    </div>
    <div id="sideNavContainer">
      <div class="side-nav-header">
        <div id="user-info"></div>
      </div>
      <div class="side-nav-actions">
        <button id="signoutBtn" class="buttonBase light">Sign Out</button>

        <!-- TEST BUTTONS start -->
        <button id="installBtn" class="buttonBase light" hidden>Install</button>
        <!-- <button id="pushMsgBtn" class="buttonBase light disabled"></button> -->
        <button id="saveDeviceToken" class="buttonBase">Save Device Token</button>
        <button id="viewDeviceToken" class="buttonBase">View Device Token</button>
        <button id="sendEmail" class="buttonBase">Send Email</button>
        <!-- <button id="sendNotification" class="buttonBase">Send Notification</button> -->
        <!-- TEST BUTTONS end -->

      </div>
      <div class="side-nav-footer">
        <p>VisualARQ Drawings Viewer</p>
      </div>
    </div>
    <div class="side-nav-shade"></div>
  </header>

  <main style="display: none;">

    <div id="mainPanel" class="right">
      <div class="panel-header"></div>
      <div class="panel-body"></div>
      <div class="panel-footer">
        <!-- TODO: put here the gear icon for settings like dock to bottom -->
      </div>
    </div>

    <div id='projectsListContainer' style="display: none;">
      <div>
        <span>
          <button id="newProjectBtn" class="buttonBase light">NEW PROJECT</button>
        </span>
        <h4>PROJECTS</h4>
        <span>
          <button id="closeProjectsListBtn" class="icon-btn hidden">
            <svg>
              <use href="#crossIcon" />
            </svg>
          </button>
        </span>
      </div>
      <div id="projectsList"></div>
      <button id="loadMoreProjBtn" class="buttonBase disabled">Load more projects</button>
    </div>

    <div id="drawingsContainer"></div>

    <div id="viewportMessage"></div>

  </main>

  <div id="modalDialogContainer" style="display: none;">
    <div>
      <span id="closeModalBtn" class="icon-btn">
        <svg>
          <use href="#crossIcon" />
        </svg>
      </span>
      <div class="modal-content"></div>
    </div>
  </div>

  <div id="messageContainer" style="display: none;" data-type="">
    <button class="icon-btn">
      <svg>
        <use href="#crossIcon" />
      </svg>
    </button>
    <p></p>
  </div>

  <div id="contextMenu" style="display:none;">
    <ul></ul>
  </div>

  <div id="panelsStorage" style="display: none;">
    <form id="commentForm">
      <textarea name="comment" id="" cols="30" rows="10"></textarea>
      <div class="buttonsContainer">
        <button type="reset" class="buttonBase light">CANCEL</button>
        <button type="submit" class="buttonBase light">ADD</button>
      </div>
    </form>
    <div id="dataTablesContainer"></div>
  </div>

  <div id="modalDialogsStorage" style="display: none;">
    <form id="uploadFileForm">
      <span id="closeUploadForm" class="icon-btn">
        <svg>
          <use href="#crossIcon" />
        </svg>
      </span>
      <div id="loadingFile" style="display: none;">
        <svg class="svg-loader">
          <use href="#vaLoader" />
        </svg>
      </div>
      <input style="display: none;" name="file" type="file" id="fileInput" />
      <label for="fileInput" class="buttonBase light">Choose a file</label>
      <button type="submit" class="buttonBase light disabled">Upload</button>
    </form>

    <div id="shareProjectDialog">
      <div class="current-users users-container">
        <p>Project shared with:</p>
        <div class="table-wrapper">
          <table class="">
            <tbody></tbody>
          </table>
          <p class="empty-msg">No members yet.</p>
        </div>
      </div>
      <div class="pending-users users-container hidden">
        <p>Pending users to share with:</p>
        <div class="table-wrapper fixed-height">
          <table class="">
            <tbody></tbody>
          </table>
        </div>
      </div>
      <form class="share-form">
        <label for="sharingEmail">Email address of members to add:</label>
        <div>
          <input type="email" name="email" id="sharingEmail" placeholder="member@gmail.com">
          <button type="submit" class="buttonBase light">Add</button>
        </div>
      </form>
      <div class="confirm-changes-btns">
        <button class="buttonBase light cancel-changes-btn disabled">Cancel</button>
        <button class="buttonBase light save-changes-btn disabled">Save changes</button>
      </div>
      <div class="loader-container hidden">
        <svg class="svg-loader">
          <use href="#vaLoader" />
        </svg>
      </div>
    </div>

    <div id="authorizeDialog">
      <img src="src/assets/vadv-logo.png" alt="VisualARQ Drawings Viewer Logo">
      <h2>VisualARQ Drawings Viewer</h2>
      <div>
        <button id="" class="buttonBase light disabled">Log in</button>
        <button id="authorizeBtn" class="buttonBase light btn-bg-img google-logo">Log in with Google</button>
        <button id="sampleProjectBtn" class="buttonBase light">View sample project</button>
        <button id="uploadProjectBtn" class="buttonBase light disabled">Upload project</button>
      </div>
    </div>
  </div>

  <div style="position:absolute;left:-100%;">
    <svg>
      <symbol id="crossIcon" viewBox="0 0 612 612">
        <polygon points="612,36.004 576.521,0.603 306,270.608 35.478,0.603 0,36.004 270.522,306.011 0,575.997 35.478,611.397 306,341.411 576.521,611.397 612,575.997 341.459,306.011" />
      </symbol>
      <symbol id="reloadIcon" viewBox="0 0 489 489">
        <path d="M268.175,488.161c98.2-11,176.9-89.5,188.1-187.7c14.7-128.4-85.1-237.7-210.2-239.1v-57.6c0-3.2-4-4.9-6.7-2.9 l-118.6,87.1c-2,1.5-2,4.4,0,5.9l118.6,87.1c2.7,2,6.7,0.2,6.7-2.9v-57.5c87.9,1.4,158.3,76.2,152.3,165.6 c-5.1,76.9-67.8,139.3-144.7,144.2c-81.5,5.2-150.8-53-163.2-130c-2.3-14.3-14.8-24.7-29.2-24.7c-17.9,0-31.9,15.9-29.1,33.6 C49.575,418.961,150.875,501.261,268.175,488.161z" />
      </symbol>
      <symbol id="vaLoader" viewBox="0 0 260.00 180.00">
        <defs>
          <style>
            @keyframes bcwall {
              0% {
                opacity: 0;
              }

              20% {
                opacity: 0;
              }

              40% {
                opacity: 1;
              }

              80% {
                opacity: 1;
              }

              100% {
                opacity: 0;
              }
            }

            @keyframes mcwall {
              0% {
                opacity: 0;
              }

              10% {
                opacity: 0;
              }

              30% {
                opacity: 1;
              }

              70% {
                opacity: 1;
              }

              90% {
                opacity: 0;
              }

              100% {
                opacity: 0;
              }
            }

            @keyframes fcwall {
              0% {
                opacity: 0;
              }

              20% {
                opacity: 1;
              }

              60% {
                opacity: 1;
              }

              80% {
                opacity: 0;
              }

              100% {
                opacity: 0;
              }
            }
          </style>
        </defs>
        <path style="fill:#157699;animation: bcwall 1.5s ease infinite" d="M 250.268,119.89L 250.268,69.3026C 250.268,69.3026 241.884,38.3601 213.985,29.2913C 205.626,26.5783 193.221,24.7016 176.165,25.7355C 143.035,27.7578 103.673,28.1618 93.5401,22.2948C 87.8621,19.0148 85.2316,13.7451 83.5916,9.95906C 82.7575,8.0193 82.7835,9.58545 82.7835,9.58545L 88.075,59.4605C 88.075,59.4605 93.766,74.7613 114.297,77.6046C 134.861,80.4415 190.369,77.7632 197.587,77.6046C 231.416,76.8552 245.698,110.439 249.35,120.47C 249.875,121.899 250.268,120.939 250.268,119.89 Z " />
        <path style="fill:#1B94C0;animation: mcwall 1.5s ease infinite;" d="M 217.877,148.213L 217.877,96.5133C 217.877,96.5133 209.488,65.5752 181.593,56.4999C 173.23,53.7912 160.821,51.9101 143.767,52.9484C 110.639,54.9641 71.2795,55.3704 61.1442,49.5099C 55.4705,46.2364 52.8357,40.9602 51.2,37.1676C 50.3594,35.23 50.3855,36.794 50.3855,36.794L 55.6812,86.6669C 55.6812,86.6669 61.3701,101.981 81.9101,104.815C 102.465,107.657 157.971,104.974 165.195,104.815C 199.02,104.068 213.304,137.645 216.956,147.681C 217.481,149.115 217.877,148.213 217.877,148.213 Z " />
        <path style="fill:#4DBBE1;animation: fcwall 1.5s ease infinite" d="M 177.889,170.79L 177.889,119.081C 177.889,119.081 169.5,88.1409 141.607,79.0808C 133.249,76.3591 120.848,74.478 103.788,75.525C 70.6535,77.5321 32.4777,77.2258 22.3489,71.3783C 16.6687,68.0853 12.85,63.5216 11.2144,59.742C 10.376,57.8088 10.4107,59.3663 10.4107,59.3663L 15.6999,109.239C 15.6999,109.239 21.3932,124.538 41.931,127.392C 62.4862,130.227 117.992,127.54 125.214,127.392C 159.039,126.647 173.317,160.216 176.977,170.244C 177.492,171.676 177.889,170.79 177.889,170.79 Z " />
      </symbol>
    </svg>
  </div>


  <script src="dist/main.js"></script>
  <script src="/src/install.js"></script>

  <!-- The core Firebase JS SDK is always required and must be listed first -->
  <script src="https://www.gstatic.com/firebasejs/7.6.1/firebase-app.js"></script>
  <!-- SDKs for Firebase products that are used -->
  <script src="https://www.gstatic.com/firebasejs/7.6.1/firebase-analytics.js"></script>
  <script src="https://www.gstatic.com/firebasejs/7.6.1/firebase-firestore.js"></script>
  <script src="https://www.gstatic.com/firebasejs/7.6.1/firebase-functions.js"></script>
  <script src="https://www.gstatic.com/firebasejs/7.6.1/firebase-messaging.js"></script>

  <script>
    // The firebase configuration for the app
    const firebaseConfig = {
      apiKey: "AIzaSyB9KC9Q3NzMt7b6TspNcKxqWqnzzPLvdFg",
      authDomain: "testgdproject-1570036439931.firebaseapp.com",
      databaseURL: "https://testgdproject-1570036439931.firebaseio.com",
      projectId: "testgdproject-1570036439931",
      storageBucket: "testgdproject-1570036439931.appspot.com",
      messagingSenderId: "199844453643",
      appId: "1:199844453643:web:4aa7ba97d1ae2e428b560e"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);

    // Retrieve Firebase Messaging object.
    const messaging = firebase.messaging();
    // When does firebase register the service worker? is it the first time it calls firebase.messaging()?


    // Handle incoming messages. Called when:
    // - a message is received while the app has focus
    // - the user clicks on an app notification created by a service worker `messaging.setBackgroundMessageHandler` handler.
    messaging.onMessage((payload) => {
      console.log('Message received. ', payload);
      // Update the UI accordingly with the new message. Paint the notifications icon.
      // ...
    });


    // TEMP
    function getMessagingToken() {
      firebase.messaging().getToken()
        .then(token => {
          console.log(token);
        })
        .catch(err => {
          console.error(err);
        })
    }

    // For this to work the user has to grant permissions first.
    // Saves the messaging device token to the datastore.
    function saveMessagingDeviceToken() {
      firebase.messaging().getToken().then(function (currentToken) {
        if (currentToken) {
          console.log('Got FCM device token:', currentToken);
          // Saving the Device Token to the datastore.
          firebase.firestore().collection('fcmTokens').doc(currentToken)
            .set({ email: 'ramoncarcelesroman@gmail.com' }); // App.user.emailAddress
        } else {
          // Need to request permissions to show notifications.
          requestNotificationsPermissions();
        }
      }).catch(function (error) {
        console.error('Unable to get messaging token.', error);
      });
    }

    // Requests permission to show notifications.
    function requestNotificationsPermissions() {
      console.log('Requesting notifications permission...');
      firebase.messaging().requestPermission().then(function () {
        // Notification permission granted.
        saveMessagingDeviceToken();
      }).catch(function (error) {
        console.error('Unable to get permission to notify.', error);
      });
    }

  </script>

</body>

</html>